<div class="box">
    <h2 class="title is-4">Step 2: Mail Configuration</h2>

    {% if errors %}
    <div class="notification is-danger">
        <button class="delete" onclick="this.parentElement.remove()"></button>
        {% for error in errors %}
        <p>{{ error }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="action" value="step2">

        <div class="field">
            <label class="label">Mail Provider</label>
            <div class="control">
                <div class="columns is-multiline">
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="mailhog" {% if provider == 'mailhog' %}checked{% endif %}>
                            <strong>MailHog</strong>
                            <span class="tag is-info is-light ml-2">Docker</span>
                            <br>
                            <small class="has-text-grey">Local email testing tool</small>
                        </label>
                    </div>
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="smtp" {% if provider == 'smtp' %}checked{% endif %}>
                            <strong>SMTP Server</strong>
                            <br>
                            <small class="has-text-grey">Custom SMTP configuration</small>
                        </label>
                    </div>
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="sendgrid" {% if provider == 'sendgrid' %}checked{% endif %}>
                            <strong>SendGrid</strong>
                            <br>
                            <small class="has-text-grey">Cloud email delivery service</small>
                        </label>
                    </div>
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="mailgun" {% if provider == 'mailgun' %}checked{% endif %}>
                            <strong>Mailgun</strong>
                            <br>
                            <small class="has-text-grey">Email automation service</small>
                        </label>
                    </div>
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="ses" {% if provider == 'ses' %}checked{% endif %}>
                            <strong>Amazon SES</strong>
                            <br>
                            <small class="has-text-grey">AWS email service</small>
                        </label>
                    </div>
                    <div class="column is-half">
                        <label class="radio box p-3 mb-2" style="display: block; cursor: pointer;">
                            <input type="radio" name="mail_provider" value="null" {% if provider == 'null' %}checked{% endif %}>
                            <strong>Disabled</strong>
                            <span class="tag is-warning is-light ml-2">Testing</span>
                            <br>
                            <small class="has-text-grey">No emails will be sent</small>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- MailHog Fields -->
        <div id="fields-mailhog" class="provider-fields">
            <div class="notification is-info is-light">
                <strong>MailHog</strong> is a local email testing tool for development.
                All emails will be captured and viewable at <a href="http://localhost:8025" target="_blank">http://localhost:8025</a>.
                <br><br>
                No configuration needed - works automatically in Docker environment.
            </div>
        </div>

        <!-- SMTP Fields -->
        <div id="fields-smtp" class="provider-fields">
            <h4 class="title is-5">SMTP Settings</h4>
            <div class="columns">
                <div class="column is-8">
                    <div class="field">
                        <label class="label">SMTP Host</label>
                        <div class="control">
                            <input class="input" type="text" name="smtp_host" value="{{ smtp_host }}" placeholder="smtp.example.com">
                        </div>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="field">
                        <label class="label">Port</label>
                        <div class="control">
                            <input class="input" type="number" name="smtp_port" value="{{ smtp_port }}" placeholder="587">
                        </div>
                    </div>
                </div>
            </div>

            <div class="columns">
                <div class="column">
                    <div class="field">
                        <label class="label">Username</label>
                        <div class="control">
                            <input class="input" type="text" name="smtp_user" value="{{ smtp_user }}">
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="field">
                        <label class="label">Password</label>
                        <div class="control">
                            <input class="input" type="password" name="smtp_password" value="{{ smtp_password }}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="field">
                <label class="label">Encryption</label>
                <div class="control">
                    <div class="select">
                        <select name="smtp_encryption">
                            <option value="tls" {% if smtp_encryption == 'tls' %}selected{% endif %}>TLS (recommended)</option>
                            <option value="ssl" {% if smtp_encryption == 'ssl' %}selected{% endif %}>SSL</option>
                            <option value="none" {% if smtp_encryption == 'none' %}selected{% endif %}>None</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- SendGrid Fields -->
        <div id="fields-sendgrid" class="provider-fields">
            <h4 class="title is-5">SendGrid Settings</h4>
            <div class="field">
                <label class="label">API Key</label>
                <div class="control">
                    <input class="input" type="password" name="sendgrid_api_key" value="{{ sendgrid_api_key }}" placeholder="SG.xxxxx">
                </div>
                <p class="help">Get your API key from <a href="https://app.sendgrid.com/settings/api_keys" target="_blank">SendGrid Dashboard</a></p>
            </div>
        </div>

        <!-- Mailgun Fields -->
        <div id="fields-mailgun" class="provider-fields">
            <h4 class="title is-5">Mailgun Settings</h4>
            <div class="field">
                <label class="label">API Key</label>
                <div class="control">
                    <input class="input" type="password" name="mailgun_api_key" value="{{ mailgun_api_key }}">
                </div>
            </div>
            <div class="field">
                <label class="label">Domain</label>
                <div class="control">
                    <input class="input" type="text" name="mailgun_domain" value="{{ mailgun_domain }}" placeholder="mg.example.com">
                </div>
            </div>
            <div class="field">
                <label class="label">Region</label>
                <div class="control">
                    <div class="select">
                        <select name="mailgun_region">
                            <option value="us" {% if mailgun_region == 'us' %}selected{% endif %}>US</option>
                            <option value="eu" {% if mailgun_region == 'eu' %}selected{% endif %}>EU</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Amazon SES Fields -->
        <div id="fields-ses" class="provider-fields">
            <h4 class="title is-5">Amazon SES Settings</h4>
            <div class="field">
                <label class="label">Region</label>
                <div class="control">
                    <div class="select">
                        <select name="ses_region">
                            <option value="us-east-1" {% if ses_region == 'us-east-1' %}selected{% endif %}>US East (N. Virginia)</option>
                            <option value="us-west-2" {% if ses_region == 'us-west-2' %}selected{% endif %}>US West (Oregon)</option>
                            <option value="eu-west-1" {% if ses_region == 'eu-west-1' %}selected{% endif %}>EU (Ireland)</option>
                            <option value="eu-central-1" {% if ses_region == 'eu-central-1' %}selected{% endif %}>EU (Frankfurt)</option>
                            <option value="ap-southeast-1" {% if ses_region == 'ap-southeast-1' %}selected{% endif %}>Asia Pacific (Singapore)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="field">
                <label class="label">Access Key ID</label>
                <div class="control">
                    <input class="input" type="text" name="ses_access_key" value="{{ ses_access_key }}">
                </div>
            </div>
            <div class="field">
                <label class="label">Secret Access Key</label>
                <div class="control">
                    <input class="input" type="password" name="ses_secret_key" value="{{ ses_secret_key }}">
                </div>
            </div>
        </div>

        <!-- Null/Disabled Fields -->
        <div id="fields-null" class="provider-fields">
            <div class="notification is-info is-light">
                Mail sending is disabled. Emails will not be sent. You can change this later in the .env file.
            </div>
        </div>

        <div class="field mt-5">
            <div class="control">
                <a href="?step=1" class="button is-light">Back</a>
                <button type="submit" class="button is-primary is-medium">
                    Continue
                </button>
            </div>
        </div>
    </form>
</div>
