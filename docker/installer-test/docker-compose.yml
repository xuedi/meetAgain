# Docker stack for testing the web installer
# Simulates a typical shared hosting environment with nginx + php-fpm + mariadb
# Usage: just installerStart / just installerStop

services:
  nginx:
    image: nginx:alpine
    container_name: ma-installer-nginx
    ports:
      - "8080:80"
    volumes:
      - ../../:/var/www/html:rw
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - php
    networks:
      - installer-test

  php:
    build:
      context: .
      dockerfile: Dockerfile.php
      args:
        HOST_UID: ${HOST_UID:-1000}
        HOST_GID: ${HOST_GID:-1000}
    container_name: ma-installer-php
    volumes:
      - ../../:/var/www/html:rw
    environment:
      - PHP_MEMORY_LIMIT=256M
    networks:
      - installer-test

  mariadb:
    image: mariadb:11.4
    container_name: ma-installer-db
    environment:
      MARIADB_ROOT_PASSWORD: rootpass
      MARIADB_DATABASE: meetagain_test
      MARIADB_USER: meetagain
      MARIADB_PASSWORD: testpass
    volumes:
      - installer-db-data:/var/lib/mysql
    networks:
      - installer-test

networks:
  installer-test:
    driver: bridge

volumes:
  installer-db-data:
