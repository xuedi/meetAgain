{% extends 'admin/base.html.twig' %}

{% block content %}

    <div class="container">

        <div class="content">
            <h1 class="title">Edit Email Template: {{ template.identifier }}</h1>
        </div>

        <div class="box mb-4">
            <h3 class="subtitle">Available Variables</h3>
            <div class="tags">
                {% for variable in template.availableVariables %}
                    <span class="tag is-info">{{ '{{' }}{{ variable }}{{ '}}' }}</span>
                {% endfor %}
            </div>
            <p class="help">Use these placeholders in your subject and body. They will be replaced with actual values when the email is sent.</p>
        </div>

        {{ form_start(form) }}
        <div class="box">
            <div class="columns">
                <div class="column is-6">
                    <p class="has-text-grey">Edit template for each language</p>
                </div>
                <div class="column is-6">
                    <div class="buttons has-addons is-pulled-right">
                        {% for locale in languages %}
                            <a class="button translation-button {% if locale == 'en' %}is-active{% endif %}"
                               id="translation-button-{{ locale }}"
                               data-id="{{ locale }}">{{ locale }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {% for locale in languages %}
                <div class="translation-div {% if locale != 'en' %}is-hidden{% endif %}" id="translation-div-{{ locale }}">
                    <div class="field">
                        <label class="label">Subject ({{ locale }})</label>
                        <div class="control">
                            {{ form_widget(form.("subject-"~locale), {'attr': {'class': 'input'}}) }}
                        </div>
                        {{ form_errors(form.("subject-"~locale)) }}
                    </div>

                    <div class="field">
                        <label class="label">Body ({{ locale }})</label>
                        <div class="control">
                            {{ form_widget(form.("body-"~locale), {'attr': {'class': 'textarea', 'rows': 15}}) }}
                        </div>
                        {{ form_errors(form.("body-"~locale)) }}
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="buttons">
            <button class="button is-link" type="submit">{{ "button_save" | trans }}</button>
            <a href="{{ path('app_admin_email_preview', {id: template.id}) }}" class="button" target="_blank">Preview</a>
            <a href="{{ path('app_admin_email') }}" class="button">Cancel</a>
        </div>
        {{ form_end(form) }}

        <form action="{{ path('app_admin_email_reset', {id: template.id}) }}" method="post" class="mt-4">
            <button type="submit" class="button is-warning" onclick="return confirm('Reset this template to the default content for all languages?');">
                Reset to Default
            </button>
        </form>

    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            let buttons = document.getElementsByClassName('translation-button');
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].addEventListener('click', event => {
                    event.preventDefault();

                    {% for locale in languages %}
                    document.getElementById('translation-button-{{ locale }}').classList.remove('is-active');
                    document.getElementById('translation-div-{{ locale }}').classList.add('is-hidden');
                    {% endfor %}

                    let button = 'translation-button-' + event.currentTarget.getAttribute('data-id');
                    document.getElementById(button).classList.add('is-active');

                    let target = 'translation-div-' + event.currentTarget.getAttribute('data-id');
                    document.getElementById(target).classList.remove('is-hidden');
                });
            }
        });
    </script>

{% endblock %}
