{% extends 'admin/base.html.twig' %}

{% block content %}

    <div class="container">

        <nav class="level">
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title">{{ announcement.cmsPage ? announcement.cmsPage.slug : 'Announcement #' ~ announcement.id }}</h1>
                </div>
                <div class="level-item">
                    {% if announcement.draft %}
                        <span class="tag is-warning is-medium">{{ 'draft' | trans }}</span>
                    {% else %}
                        <span class="tag is-success is-medium">{{ 'sent' | trans }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <a href="{{ path('app_admin_announcement') }}" class="button">
                        <span class="icon"><i class="fa fa-arrow-left"></i></span>
                        <span>{{ 'button_back' | trans }}</span>
                    </a>
                </div>
            </div>
        </nav>

        <div class="columns">
            <div class="column is-8">

                <div class="box">
                    <h2 class="subtitle">{{ 'announcement_details' | trans }}</h2>

                    <table class="table is-fullwidth">
                        <tbody>
                        <tr>
                            <th style="width: 200px;">{{ 'announcement_cms_page' | trans }}</th>
                            <td>
                                {% if announcement.cmsPage %}
                                    <a href="{{ path('app_admin_cms_edit', {'id': announcement.cmsPage.id}) }}">
                                        {{ announcement.cmsPage.slug }}
                                    </a>
                                    {% if not announcement.cmsPage.published %}
                                        <span class="tag is-warning is-small">{{ 'unpublished' | trans }}</span>
                                    {% endif %}
                                {% else %}
                                    <span class="has-text-danger">{{ 'no_cms_page' | trans }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>{{ 'announcement_created_by' | trans }}</th>
                            <td>{{ announcement.createdBy.name }}</td>
                        </tr>
                        <tr>
                            <th>{{ 'announcement_created' | trans }}</th>
                            <td>{{ announcement.createdAt|date('Y-m-d H:i') }}</td>
                        </tr>
                        {% if announcement.sent %}
                        <tr>
                            <th>{{ 'announcement_sent_at' | trans }}</th>
                            <td>{{ announcement.sentAt|date('Y-m-d H:i') }}</td>
                        </tr>
                        <tr>
                            <th>{{ 'announcement_recipients' | trans }}</th>
                            <td>{{ announcement.recipientCount }}</td>
                        </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>

                {% if preview %}
                <div class="box">
                    <div class="level">
                        <div class="level-left">
                            <h2 class="subtitle">{{ 'announcement_email_preview' | trans }}</h2>
                        </div>
                        <div class="level-right">
                            <div class="buttons has-addons">
                                {% for locale in enabled_locales %}
                                    <a href="{{ path('app_admin_announcement_view', {'id': announcement.id, 'locale': locale}) }}"
                                       class="button is-small {% if locale == previewLocale %}is-active is-info{% endif %}">
                                        {{ locale }}
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <p><strong>{{ 'email_subject' | trans }}:</strong> {{ preview.subject }}</p>
                    <hr>
                    <div class="content">
                        {{ preview.body | raw }}
                    </div>
                </div>
                {% endif %}

            </div>

            <div class="column is-4">
                <div class="box">
                    <h2 class="subtitle">{{ 'actions' | trans }}</h2>

                    {% if announcement.draft %}
                        <form action="{{ path('app_admin_announcement_send', {'id': announcement.id}) }}" method="post" class="mb-3">
                            <button type="submit" class="button is-success is-fullwidth" onclick="return confirm('{{ 'confirm_send_announcement' | trans }}');">
                                <span class="icon"><i class="fa fa-paper-plane"></i></span>
                                <span>{{ 'button_send_announcement' | trans }}</span>
                            </button>
                        </form>

                        {% if announcement.cmsPage %}
                        <a href="{{ path('app_admin_cms_edit', {'id': announcement.cmsPage.id}) }}" class="button is-info is-fullwidth mb-3">
                            <span class="icon"><i class="fa fa-edit"></i></span>
                            <span>{{ 'button_edit_cms_page' | trans }}</span>
                        </a>
                        {% endif %}

                        <a href="{{ path('app_admin_announcement_edit', {'id': announcement.id}) }}" class="button is-fullwidth mb-3">
                            <span class="icon"><i class="fa fa-exchange-alt"></i></span>
                            <span>{{ 'button_change_cms_page' | trans }}</span>
                        </a>

                        <a href="{{ path('app_admin_announcement_preview', {'id': announcement.id, 'locale': previewLocale}) }}" class="button is-fullwidth mb-3">
                            <span class="icon"><i class="fa fa-eye"></i></span>
                            <span>{{ 'button_preview' | trans }}</span>
                        </a>

                        <form action="{{ path('app_admin_announcement_delete', {'id': announcement.id}) }}" method="post">
                            <button type="submit" class="button is-danger is-fullwidth" onclick="return confirm('{{ 'confirm_delete_announcement' | trans }}');">
                                <span class="icon"><i class="fa fa-trash"></i></span>
                                <span>{{ 'button_delete' | trans }}</span>
                            </button>
                        </form>
                    {% else %}
                        {% if announcement.cmsPage %}
                        <a href="{{ path('app_admin_cms_edit', {'id': announcement.cmsPage.id}) }}" class="button is-info is-fullwidth">
                            <span class="icon"><i class="fa fa-edit"></i></span>
                            <span>{{ 'button_edit_cms_page' | trans }}</span>
                        </a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

{% endblock %}
