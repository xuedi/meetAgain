{% extends 'base.html.twig' %}

{% block title %}Review Suggestions - {{ dish.getTranslatedName(dish.originLang ?? app.locale) }}{% endblock %}

{% block body %}

    <section class="section">
        <div class="container">

            <nav class="breadcrumb" aria-label="breadcrumbs">
                <ul>
                    <li><a href="{{ path('app_plugin_dishes') }}">Dishes</a></li>
                    <li><a href="{{ path('plugin_dishes_suggestions_list') }}">Suggestions</a></li>
                    <li class="is-active"><a href="#" aria-current="page">{{ dish.getTranslatedName(dish.originLang ?? app.locale) }}</a></li>
                </ul>
            </nav>

            <div class="columns">
                <div class="column is-8">
                    <h1 class="title">
                        <span class="icon"><i class="fa-solid fa-lightbulb"></i></span>
                        <span>Review Suggestions</span>
                    </h1>
                    <p class="subtitle">{{ dish.getTranslatedName(dish.originLang ?? app.locale) }}</p>

                    {% if suggestions is empty %}
                        <div class="notification is-info is-light">
                            No pending suggestions for this dish.
                        </div>
                    {% else %}
                        {% for suggestion in suggestions %}
                            <div class="box">
                                <div class="level">
                                    <div class="level-left">
                                        <div class="level-item">
                                            <span class="tag is-info is-medium">{{ suggestion.language|upper }}</span>
                                        </div>
                                        <div class="level-item">
                                            <span class="tag is-light is-medium">{{ suggestion.field.value }}</span>
                                        </div>
                                    </div>
                                    <div class="level-right">
                                        <div class="level-item">
                                            <span class="has-text-grey is-size-7">
                                                by {{ get_user_name(suggestion.createdBy) }}
                                                {{ suggestion.createdAt|time_diff }}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="content">
                                    <p><strong>Suggested value:</strong></p>
                                    <blockquote>{{ suggestion.value|nl2br }}</blockquote>
                                </div>

                                {% set currentValue = '' %}
                                {% if suggestion.field.value == 'origin' %}
                                    {% set currentValue = dish.origin %}
                                {% else %}
                                    {% set trans = dish.findTranslation(suggestion.language) %}
                                    {% if trans %}
                                        {% if suggestion.field.value == 'name' %}
                                            {% set currentValue = trans.name %}
                                        {% elseif suggestion.field.value == 'phonetic' %}
                                            {% set currentValue = trans.phonetic %}
                                        {% elseif suggestion.field.value == 'description' %}
                                            {% set currentValue = trans.description %}
                                        {% elseif suggestion.field.value == 'recipe' %}
                                            {% set currentValue = trans.recipe %}
                                        {% endif %}
                                    {% endif %}
                                {% endif %}

                                {% if currentValue %}
                                    <div class="content">
                                        <p><strong>Current value:</strong></p>
                                        <blockquote class="has-text-grey">{{ currentValue|nl2br }}</blockquote>
                                    </div>
                                {% else %}
                                    <p class="has-text-grey is-size-7"><em>No current value (new translation)</em></p>
                                {% endif %}

                                <div class="buttons">
                                    <a href="{{ path('plugin_dishes_suggestion_apply', {'id': dish.id, 'hash': suggestion.hash}) }}"
                                       class="button is-success">
                                        <span class="icon"><i class="fa-solid fa-check"></i></span>
                                        <span>Apply</span>
                                    </a>
                                    <a href="{{ path('plugin_dishes_suggestion_deny', {'id': dish.id, 'hash': suggestion.hash}) }}"
                                       class="button is-danger is-light">
                                        <span class="icon"><i class="fa-solid fa-times"></i></span>
                                        <span>Reject</span>
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="column is-4">
                    <div class="box">
                        <h3 class="title is-5">Dish Info</h3>
                        {% if dish.previewImage %}
                            {% include '_block/image.html.twig' with {'image': dish.previewImage, 'size': '300x300'} %}
                        {% endif %}
                        <p class="mt-3"><strong>Original language:</strong> {{ dish.originLang|upper }}</p>
                        {% if dish.origin %}
                            <p><strong>Origin:</strong> {{ dish.origin }}</p>
                        {% endif %}
                        <p><strong>Likes:</strong> {{ dish.likes }}</p>
                    </div>

                    <div class="box">
                        <h3 class="title is-5">Existing Translations</h3>
                        {% for translation in dish.translation %}
                            <div class="mb-3">
                                <span class="tag is-info">{{ translation.language|upper }}</span>
                                <span>{{ translation.name }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="mt-5">
                <a href="{{ path('plugin_dishes_suggestions_list') }}" class="button">
                    <span class="icon"><i class="fa-solid fa-arrow-left"></i></span>
                    <span>Back to Suggestions</span>
                </a>
            </div>

        </div>
    </section>

{% endblock %}
