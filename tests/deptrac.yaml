deptrac:
  paths:
    - ../src

  cache_file: var/cache/deptrac.cache

  layers:
    - name: Controller
      collectors:
        - type: directory
          value: src/Controller/.*

    - name: Service
      collectors:
        - type: directory
          value: src/Service/.*

    - name: Repository
      collectors:
        - type: directory
          value: src/Repository/.*

    - name: Entity
      collectors:
        - type: directory
          value: src/Entity/.*

    - name: Form
      collectors:
        - type: directory
          value: src/Form/.*

    - name: Command
      collectors:
        - type: directory
          value: src/Command/.*

    - name: Security
      collectors:
        - type: directory
          value: src/Security/.*

    - name: Twig
      collectors:
        - type: directory
          value: src/Twig/.*

    - name: EventSubscriber
      collectors:
        - type: directory
          value: src/EventSubscriber/.*

    - name: DataFixtures
      collectors:
        - type: directory
          value: src/DataFixtures/.*

  ruleset:
    # Controllers: thin, delegate to services
    Controller:
      - Service
      - Entity
      - Form
      - Security
      - Repository  # TODO: refactor to use services instead

    # Services: business logic, can use repositories
    Service:
      - Repository
      - Entity

    # Entities: pure data objects, no dependencies
    Entity: []

    # Repositories: data access, only know entities
    Repository:
      - Entity

    # Forms: can use entities and services for validation/choices
    Form:
      - Entity
      - Service
      - Repository

    # Commands: CLI entry points, similar to controllers
    Command:
      - Service
      - Entity

    # Security: authentication/authorization logic
    Security:
      - Entity
      - Repository
      - Service

    # Twig extensions: presentation helpers
    Twig:
      - Entity
      - Service

    # Event subscribers: react to system events
    EventSubscriber:
      - Service
      - Entity

    # Fixtures: test data, allowed more flexibility
    DataFixtures:
      - Entity
      - Repository
      - Service

  skip_violations:
    # TODO: MenuRoutes enum references controllers for route names - consider refactoring
    App\Entity\MenuRoutes:
      - App\Controller\ProfileController
      - App\Controller\EventController
      - App\Controller\MemberController
      - App\Controller\ManageController
      - App\Controller\AdminController
      - App\Controller\SecurityController
      - App\Controller\TranslationController

    # TODO: EventSubscriber references controller for route comparison - consider using route names
    App\EventSubscriber\KernelRequestSubscriber:
      - App\Controller\SecurityController

    # TODO: Twig extension references controller - consider refactoring
    App\Twig\RenderImageModalExtension:
      - App\Controller\ImageUploadController

    # Fixture command needs direct repository access for bulk user retrieval
    App\Command\EventAddFixtureRsvpsCommand:
      - App\Repository\UserRepository